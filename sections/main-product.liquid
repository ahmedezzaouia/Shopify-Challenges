{%- liquid
 assign current_variant = product.selected_or_first_available_variant | default: product.variants.first
 assign current_selling_plan_allocation = current_variant.selected_selling_plan_allocation

 if current_selling_plan_allocation == nil and current_variant.requires_selling_plan
  assign current_selling_plan_allocation = current_variant.selling_plan_allocations | first
 endif

 assign offer = current_selling_plan_allocation | default: current_variant
-%}

{{ product.title }}
{{ offer.price | money }}

{% if offer.compare_at_price > offer.price %}
  <s>{{ offer.compare_at_price | money }}</s>
  <span>{% if offer.selling_plan %}Subscription{% else %}Sale{% endif %}</span>
{% endif %}

{% form 'product', product %}
  <input type="hidden" name="id" value="{{ current_variant.id }}">
  <input type="hidden" name="selling_plan" value="{{ current_selling_plan_allocation.selling_plan.id | default: '' }}">

  <fieldset>
    <legend>Product options</legend>

    {% for option in product.options_with_values %}
      <label>{{ option.name }}</label>

      <select>
        {% for value in option.values %}
          <option>{{ value }}</option>
        {% endfor %}
      </select>
    {% endfor %}
  </fieldset>

  <!-- Pass the product object as JSON so it can be used to update selling plan information using JavaScript -->
  <fieldset class="selling-plan-fieldset" data-product={{ product | json }}>
    <legend>Purchase options</legend>
    {% unless product.requires_selling_plan %}
    <input type="radio" name="purchase_option"> One-time purchase
    {% endunless %}

    {% for group in product.selling_plan_groups %}
      <input type="radio" name="purchase_option"> {{ group.name}}

      {% for option in group.options %}
        <label>{{ option.name }}</label>

        <select data-position="{{ option.position }}">
          {% for value in option.values %}
            <option>{{ value }}</option>
          {% endfor %}
        </select>
      {% endfor %}
    {% endfor %}
  </fieldset>




<h2>the subscription: </h2>

<div>
  {% for group in product.selling_plan_groups %}
  <fieldset>
    <legend {%- if hidelegend %} style="display: none;"{% endif %}>Pick a subscription</legend>
    {% unless product.requires_selling_plan %}
      <input type="radio" name="selling_plan" value="" id="selling_plan_onetime"> <label for="selling_plan_onetime">One-time purchase</label><br>
    {% endunless %}
    {% for selling_plan in group.selling_plans %}
    <input type="radio" {%- if forloop.first %} checked="checked"{% endif %} name="selling_plan" value="{{ selling_plan.id }}" id="selling_plan_{{ selling_plan.id }}">
    <label for="selling_plan_{{ selling_plan.id }}">{{ selling_plan.name }}</label><br>
    {% endfor %}
  </fieldset>
  {% endfor %}
</div>
{% endform %}
